<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- 页面meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


    <title>创建订单</title>
    <meta name="description" content="创建订单">
    <meta name="keywords" content="创建订单">


    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.6 -->
    <!-- Font Awesome -->
    <!-- Ionicons -->
    <!-- iCheck -->
    <!-- Morris chart -->
    <!-- jvectormap -->
    <!-- Date Picker -->
    <!-- Daterange picker -->
    <!-- Bootstrap time Picker -->
    <!--<link rel="stylesheet" href="../static/admin/../static/admin/../static/admin/plugins/timepicker/bootstrap-timepicker.min.css">-->
    <!-- bootstrap wysihtml5 - text editor -->
    <!--数据表格-->
    <!-- 表格树 -->
    <!-- select2 -->
    <!-- Bootstrap Color Picker -->
    <!-- bootstrap wysihtml5 - text editor -->
    <!--bootstrap-markdown-->
    <!-- Theme style -->
    <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
    <!-- Ion Slider -->
    <!-- ion slider Nice -->
    <!-- bootstrap slider -->
    <!-- bootstrap-datetimepicker -->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


    <!-- jQuery 2.2.3 -->
    <!-- jQuery UI 1.11.4 -->
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <!-- Bootstrap 3.3.6 -->
    <!-- Morris.js charts -->
    <!-- Sparkline -->
    <!-- jvectormap -->
    <!-- jQuery Knob Chart -->
    <!-- daterangepicker -->
    <!-- datepicker -->
    <!-- Bootstrap WYSIHTML5 -->
    <!-- Slimscroll -->
    <!-- FastClick -->
    <!-- iCheck -->
    <!-- AdminLTE App -->
    <!-- 表格树 -->
    <!-- select2 -->
    <!-- bootstrap color picker -->
    <!-- bootstrap time picker -->
    <!--<script src="../static/admin/../static/admin/../static/admin/plugins/timepicker/bootstrap-timepicker.min.js"></script>-->
    <!-- Bootstrap WYSIHTML5 -->
    <!--bootstrap-markdown-->
    <!-- CK Editor -->
    <!-- InputMask -->
    <!-- DataTables -->
    <!-- ChartJS 1.0.1 -->
    <!-- FLOT CHARTS -->
    <!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
    <!-- FLOT PIE PLUGIN - also used to draw donut charts -->
    <!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts -->
    <!-- jQuery Knob -->
    <!-- Sparkline -->
    <!-- Morris.js charts -->
    <!-- Ion Slider -->
    <!-- Bootstrap slider -->
    <!-- bootstrap-datetimepicker -->
    <!-- 页面meta /-->

    <link rel="stylesheet" href="../static/admin/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/admin/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../static/admin/plugins/ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="../static/admin/plugins/iCheck/square/blue.css">
    <link rel="stylesheet" href="../static/admin/plugins/morris/morris.css">
    <link rel="stylesheet" href="../static/admin/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <link rel="stylesheet" href="../static/admin/plugins/datepicker/datepicker3.css">
    <link rel="stylesheet" href="../static/admin/plugins/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href="../static/admin/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <link rel="stylesheet" href="../static/admin/plugins/datatables/dataTables.bootstrap.css">
    <link rel="stylesheet" href="../static/admin/plugins/treeTable/jquery.treetable.css">
    <link rel="stylesheet" href="../static/admin/plugins/treeTable/jquery.treetable.theme.default.css">
    <link rel="stylesheet" href="../static/admin/plugins/select2/select2.css">
    <link rel="stylesheet" href="../static/admin/plugins/colorpicker/bootstrap-colorpicker.min.css">
    <link rel="stylesheet" href="../static/admin/plugins/bootstrap-markdown/css/bootstrap-markdown.min.css">
    <link rel="stylesheet" href="../static/admin/plugins/adminLTE/css/AdminLTE.css">
    <link rel="stylesheet" href="../static/admin/plugins/adminLTE/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="../static/admin/css/style.css">
    <link rel="stylesheet" href="../static/admin/plugins/ionslider/ion.rangeSlider.css">
    <link rel="stylesheet" href="../static/admin/plugins/ionslider/ion.rangeSlider.skinNice.css">
    <link rel="stylesheet" href="../static/admin/plugins/bootstrap-slider/slider.css">
    <link rel="stylesheet" href="../static/admin/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.css">
</head>

<body>


<!-- 内容头部 -->
<section class="content-header">
    <h1>
        填写订单
    </h1>
</section>
<br/>
<!-- 内容头部 /-->


<!--订单信息-->
<div class="panel panel-default">
    <div class="panel-heading">收货人信息</div>

    <div class="row data-type">
        <div class="col-md-2 title rowHeight2x">地址栏</div>
        <div class="col-md-8 data rowHeight2x">
            <select id="select" onchange="find(this)"  style="height: 75px; font-size: 50px" class="form-control" name="type">
                <th:block th:each="address : ${addressList}">
                    <option th:if="${#strings.length(address.detail)} <= 10"
                            th:value="${address.id}" th:text="${address.detail}"></option>
                    <option th:if="${#strings.length(address.detail)} > 10"
                            th:value="${address.id}"
                            th:text="${address.detail.substring(0,8)} + '.....'"></option>
                </th:block>
            </select>
        </div>
        <div class="col-md-2 data rowHeight2x">
        </div>

        <form action="/order/addOrder" method="post" id="form">
            <input hidden name="ids" id="ids">
            <div class="col-md-2 title">收货人姓名</div>
            <div class="col-md-2 data">
                <input name="receiver" type="text" id="name" class="intputClass form-control" placeholder="收货人姓名"
                       value="">
            </div>
            <div class="col-md-2 data">
                <label style="color: red" id="nameError" class="errorClass"></label>
            </div>


            <div class="col-md-2 title">收货人手机</div>
            <div class="col-md-2 data">
                <input type="text" name="receiverPhone" id="phone" class="intputClass form-control" placeholder="收货人手机"
                       value="">
            </div>
            <div class="col-md-2 data">
                <label style="color: red" id="phoneError" class="errorClass"></label>
            </div>

            <div class="col-md-2 title">邮编</div>
            <div class="col-md-2 data">
                <input type="text" name="receiverZip" class="form-control" placeholder="邮编" value="">
            </div>
            <div class="col-md-2 data">
                <label></label>
            </div>

            <div class="col-md-2 title">支付方式</div>
            <div class="col-md-2 data">
                <select name="paymentType" class="form-control select2" style="width: 100%;">
                    <option value="1" selected="selected">微信支付</option>
                </select>
            </div>
            <div class="col-md-2 data">
            </div>


            <div class="col-md-2 title rowHeight2x">收货地址</div>
            <div class="col-md-8 data rowHeight2x">
                <textarea name="receiverAddress" id="address" class="intputClass form-control" rows="3"
                          placeholder="收货地址"></textarea>
            </div>
            <div class="col-md-2 data rowHeight2x">
                <label style="color: red" id="addressError" class="errorClass"></label>
            </div>

            <div class="col-md-2 title rowHeight2x">买家留言</div>
            <div class="col-md-8 data rowHeight2x">
                <textarea name="buyerMessage" class="form-control" rows="3" placeholder="买家留言"></textarea>
            </div>
            <div class="col-md-2 data rowHeight2x">
                <label></label>
            </div>
        </form>
    </div>
</div>
<!--订单信息/-->

<!--商品信息-->
<div class="panel panel-default">
    <div class="panel-heading">商品列表</div>
    <!--数据列表-->
    <table class="table table-hover">
        <thead>
        <tr>
            <th class="text-center"></th>
            <th class="text-center">书名</th>
            <th class="text-center">单价</th>
            <th class="text-center">数量</th>
            <th class="text-center">小计</th>
        </tr>
        </thead>
        <tbody style="text-align: center">
        <tr th:name="${cart.bookId}" th:each="cart : ${cartList}">
            <td>
                <div class="line-center" style="width: 50px;height: 50px;">
                    <img th:src="@{'../static/img/bookImg/' + ${cart.img} }" style="height: 100%;" alt=""/>
                </div>
            </td>
            <td>

                <div class="line-center" th:text="${cart.bookName}">java程序设计但是名字还不够是的发的3423424234</div>

            </td>
            <td>
                <div class="line-center" th:text="'￥' + ${#numbers.formatDecimal((cart.price)/100.00,2,2)}">
                    ￥55.60
                </div>
            </td>
            <td>
                <div th:name="${cart.bookId}" class=" line-center">
                    <div type="text" class="number small text-center" th:text="${cart.number}"/>
                </div>
            </td>
            <td>
                <div class="price line-center"
                     th:text="'￥ ' + ${#numbers.formatDecimal((cart.price * cart.number)/100.00,2,2)}">$20000.00
                </div>
            </td>
        </tr>
        </tbody>
        <tfoot>


        <tr>
            <td colspan="4"></td>
            <td class="text-center">邮费：¥ 10.00</td>
        </tr>

        <tr th:if="${favorable} > 0" id="favorable">
            <td ></td>
            <td ></td>
            <td ></td>
            <td ></td>
            <td style="text-align: center; color: red" th:text=" '优惠 - ¥' + ${#numbers.formatDecimal(favorable/100.00,2,2)}"></td>
        </tr>

        <tr>
            <td colspan="4">统计</td>
            <td id="totalPrice" class="text-center">总价:￥10000</td>
        </tr>


        </tfoot>
    </table>
    <!--数据列表/-->
</div>
<!--商品信息/-->

<!--工具栏-->
<div class="box-tools text-center">
    <button id="submit" type="button" class="btn bg-maroon">提交订单</button>
    <button type="button" class="btn btn-info" onclick="history.back(-1);">返回</button>
</div>
<!--工具栏/-->


<script src="../static/admin/plugins/jQuery/jquery-2.2.3.min.js"></script>
<script src="../static/admin/plugins/jQueryUI/jquery-ui.min.js"></script>
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>
<script src="../static/admin/plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="../static/admin/plugins/raphael/raphael-min.js"></script>
<script src="../static/admin/plugins/morris/morris.min.js"></script>
<script src="../static/admin/plugins/sparkline/jquery.sparkline.min.js"></script>
<script src="../static/admin/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="../static/admin/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<script src="../static/admin/plugins/knob/jquery.knob.js"></script>
<script src="../static/admin/plugins/daterangepicker/moment.min.js"></script>
<script src="../static/admin/plugins/daterangepicker/daterangepicker.js"></script>
<script src="../static/admin/plugins/daterangepicker/daterangepicker.zh-CN.js"></script>
<script src="../static/admin/plugins/datepicker/bootstrap-datepicker.js"></script>
<script src="../static/admin/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script>
<script src="../static/admin/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<script src="../static/admin/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<script src="../static/admin/plugins/fastclick/fastclick.js"></script>
<script src="../static/admin/plugins/iCheck/icheck.min.js"></script>
<script src="../static/admin/plugins/adminLTE/js/app.min.js"></script>
<script src="../static/admin/plugins/treeTable/jquery.treetable.js"></script>
<script src="../static/admin/plugins/select2/select2.full.min.js"></script>
<script src="../static/admin/plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
<script src="../static/admin/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.zh-CN.js"></script>
<script src="../static/admin/plugins/bootstrap-markdown/js/bootstrap-markdown.js"></script>
<script src="../static/admin/plugins/bootstrap-markdown/locale/bootstrap-markdown.zh.js"></script>
<script src="../static/admin/plugins/bootstrap-markdown/js/markdown.js"></script>
<script src="../static/admin/plugins/bootstrap-markdown/js/to-markdown.js"></script>
<script src="../static/admin/plugins/ckeditor/ckeditor.js"></script>
<script src="../static/admin/plugins/input-mask/jquery.inputmask.js"></script>
<script src="../static/admin/plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
<script src="../static/admin/plugins/input-mask/jquery.inputmask.extensions.js"></script>
<script src="../static/admin/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../static/admin/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script src="../static/admin/plugins/chartjs/Chart.min.js"></script>
<script src="../static/admin/plugins/flot/jquery.flot.min.js"></script>
<script src="../static/admin/plugins/flot/jquery.flot.resize.min.js"></script>
<script src="../static/admin/plugins/flot/jquery.flot.pie.min.js"></script>
<script src="../static/admin/plugins/flot/jquery.flot.categories.min.js"></script>
<script src="../static/admin/plugins/ionslider/ion.rangeSlider.min.js"></script>
<script src="../static/admin/plugins/bootstrap-slider/bootstrap-slider.js"></script>
<script src="../static/admin/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.js"></script>
<script src="../static/admin/plugins/bootstrap-datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script th:inline="javascript">

    $(document).ready(function () {

        $("#submit").click(function () {

            var bool = true;
            if (!verifyName()) {
                bool = false;
            }
            if (!verifyPhone()) {
                bool = false;
            }

            if (!verifyAddress()) {
                bool = false;
            }

            if (bool) {
                $("#form").submit();
            }
        })
    })

    $(document).ready(function () {
        var list = /*[[${cartList}]]*/0;
        var cartIds = new Array();
        for (let index in list) {
            cartIds[index] = list[index].bookId;
        }

        $("#ids").val(cartIds);

    })

    $(document).ready(function () {
        // 选择框
        $(".select2").select2();

        // WYSIHTML5编辑器
        $(".textarea").wysihtml5({
            locale: 'zh-CN'
        });
    });


    // 设置激活菜单
    function setSidebarActive(tagUri) {
        var liObj = $("#" + tagUri);
        if (liObj.length > 0) {
            liObj.parent().parent().addClass("active");
            liObj.addClass("active");
        }
    }


    $(document).ready(function () {
        $('#datepicker-a3').datepicker({
            autoclose: true,
            language: 'zh-CN'
        });
    });


    $(document).ready(function () {
        $('#datepicker-a6').datepicker({
            autoclose: true,
            language: 'zh-CN'
        });
    });


    $(document).ready(function () {
        // 激活导航位置
        setSidebarActive("order-manage");
    });

    function totalPrice() {

        var total = 0;

        $(".price").each(function () {
            var price = $(this).text().substring(2) * 100;
            total += price;
        })

        //计算是否可以优惠

        var favorable = /*[[${favorable}]]*/0;
        console.log(favorable);

        total += 1000;

        if (favorable = 0){
            $("#favorable").hide();
        }else {
            total -= /*[[${favorable}]]*/0;
        }



        total = total / 100;
        total = total.toFixed(2);
        $("#totalPrice").text("总价：¥ " + total);

    }

    $(document).ready(function () {
        totalPrice();

        //给每个input都添加得到焦点事件
        $(".intputClass").focus(function () {
            //获取当前元素的id
            var lableId = $(this).prop("id");

            //把lable中的内容清空
            $("#" + lableId + "Error").text("");
            showError($("#" + lableId + "Error"));

        })

        //失去焦点事件
        $(".intputClass").blur(function () {

            //对表单进行校验
            //获取id值
            var id = $(this).prop("id");
            //获取方法名
            var funName = "verify" + id.substring(0, 1).toUpperCase() + id.substring(1) + "()";
            //调用方法
            eval(funName);

        })



    })

    function verifyName() {
        var id = "name";
        var value = $("#" + id).val();
        //1.非空校验
        if (!value) {

            $("#" + id + "Error").text("名字不能为空");
            //显示错误信息
            showError($("#" + id + "Error"));
            return false;
        }

        return true;
    }

    function verifyPhone() {
        var id = "phone";
        var value = $("#" + id).val();

        if (!(/^1[3456789]\d{9}$/.test(value))) {

            $("#" + id + "Error").text("手机号码格式不正确");
            //显示错误信息
            showError($("#" + id + "Error"));
            return false;
        }

        return true;
    }

    function verifyAddress() {
        var id = "address";
        var value = $("#" + id).val();
        //1.非空校验
        if (!value) {

            $("#" + id + "Error").text("地址不能为空");
            //显示错误信息
            showError($("#" + id + "Error"));
            return false;
        }

        return true;
    }

    //展示错误信息
    function showError(element) {
        var text = element.text();
        if (!text) {
            //如果为空，隐藏元素
            element.css("display", "none");
        } else {

            //有内容，显示该元素
            element.css("display", "");

        }

    }

    function find(element) {

        var list = /*[[${addressList}]]*/ {};

        var count = $(element).val();

        for (var i = 0; i < list.length; i++){

            if(count ==list[i].id){
                $("#name").val(list[i].name);
                $("#phone").val(list[i].phone);
                $("#receiverZip").val(list[i].zip);
                $("#address").val(list[i].detail);
                break;
            }

        }




    }

    $(function () {

        //================下拉菜单的js===============
        var bool = true;
        $("#open").click(function () {

            if (bool){
                console.log(123);
                $(this).removeClass("dropdown");
                $(this).addClass("dropdown open");
                bool = !bool;
            }else {
                console.log(321);
                $(this).removeClass("dropdown open");
                $(this).addClass("dropdown");
                bool = !bool;
            }

        });
        //================下拉菜单的js===============


        //================ 加载第一个地址信息填充 =================
        var list = /*[[${addressList}]]*/ {};
        if (list[0] != null) {
            $("#name").val(list[0].name);
            $("#phone").val(list[0].phone);
            $("#zip").val(list[0].zip);
            $("#address").val(list[0].detail);
        }
        //================ 加载第一个地址信息填充 =================

    })


</script>
</body>

</html>